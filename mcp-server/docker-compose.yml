services:
  mcp-server:
    image: ghcr.io/dtkmn/mcp-zap-server:7556843
    ports:
      - "7456:7456"
    environment:
      # ZAP Connection - API on port 8080 in daemon mode
      - ZAP_BASE_URL=http://zaproxy:8080
      - ZAP_API_KEY=${ZAP_API_KEY:-}

      # MCP Server Security
      - MCP_SECURITY_ENABLED=${MCP_SECURITY_ENABLED:-true}
      - MCP_SECURITY_MODE=${MCP_SECURITY_MODE:-api-key}
      - MCP_API_KEY=${MCP_API_KEY}

      # Scan Limits
      - ZAP_MAX_ACTIVE_SCAN_DURATION=${ZAP_MAX_ACTIVE_SCAN_DURATION:-30}
      - ZAP_MAX_SPIDER_SCAN_DURATION=${ZAP_MAX_SPIDER_SCAN_DURATION:-10}

      # URL Security (allow private networks for internal scanning)
      - ZAP_ALLOW_PRIVATE_NETWORKS=${ZAP_ALLOW_PRIVATE_NETWORKS:-true}
    networks:
      - dokploy-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7456/actuator/health"]
      interval: 15s
      timeout: 5s
      retries: 3

networks:
  dokploy-network:
    external: true
